# RAG Converter Pro - Инструкция по установке

## Описание
Веб-приложение для конвертации PDF и TXT файлов в формат датасета для RAG-систем с системой подписки и оплатой через Paddle.

---

## Требования

### Программное обеспечение
- **Python** 3.9 или выше
- **PostgreSQL** 12 или выше
- **pip** (менеджер пакетов Python)

### Аккаунты
- **Paddle** аккаунт продавца для приема платежей

---

## Пошаговая установка

### 1. Скачивание проекта

```bash
cd c:\PROEKT\konv
```

### 2. Создание виртуального окружения (рекомендуется)

```bash
# Создание виртуального окружения
python -m venv venv

# Активация (Windows)
venv\Scripts\activate

# Активация (Linux/Mac)
source venv/bin/activate
```

### 3. Установка зависимостей

```bash
pip install -r requirements.txt
```

### 4. Настройка PostgreSQL

#### Установка PostgreSQL (если не установлен)
1. Скачайте с https://www.postgresql.org/download/
2. Установите и запомните пароль для пользователя `postgres`

#### Создание базы данных
```sql
-- Подключитесь к PostgreSQL
psql -U postgres

-- Создайте базу данных
CREATE DATABASE rag_converter;

-- Выход
\q
```

### 5. Настройка конфигурации

Откройте файл `.env` и заполните:

```env
# Секретный ключ Flask (сгенерируйте уникальный)
SECRET_KEY=ваш-уникальный-секретный-ключ-минимум-32-символа

# Подключение к PostgreSQL
# Формат: postgresql://пользователь:пароль@хост:порт/база
DATABASE_URL=postgresql://postgres:ваш_пароль@localhost:5432/rag_converter

# Ключи Paddle
PADDLE_CLIENT_TOKEN=<your_client_token>
PADDLE_PRICE_ID=pri_01kh0xww2yy5zkmbmq2psgk93t
PADDLE_WEBHOOK_SECRET=<your_webhook_secret>
PADDLE_ENV=live
PADDLE_WEBHOOK_URL=https://ваш-домен/payment/paddle/webhook
SUBSCRIPTION_PRICE=9
```

#### Как получить ключи Paddle:
1. Зайдите на https://paddle.com/
2. Войдите в личный кабинет мерчанта
3. Перейдите в раздел "API"
4. Скопируйте публичный и приватный ключи

### 6. Запуск приложения

#### Режим разработки
```bash
python run.py
```

Приложение будет доступно по адресу: http://localhost:5000

#### Продакшен (с Gunicorn)
```bash
pip install gunicorn
gunicorn -w 4 -b 0.0.0.0:5000 run:app
```

---

## Структура проекта

```
c:\PROEKT\konv\
├── app/
│   ├── __init__.py          # Инициализация Flask приложения
│   ├── config.py             # Настройки приложения
│   ├── models.py             # Модели базы данных
│   ├── auth/                 # Модуль аутентификации
│   ├── main/                 # Основные страницы
│   ├── payment/              # Интеграция с Paddle
│   ├── converter/            # Логика конвертации
│   ├── static/css/           # Стили
│   └── templates/            # HTML шаблоны
├── logs/                     # Логи приложения (создается автоматически)
├── requirements.txt          # Зависимости Python
├── run.py                    # Точка входа
└── .env                      # Конфигурация (НЕ КОММИТИТЬ!)
```

---

## Использование

### Для пользователей:
1. Зарегистрируйтесь на сайте
2. Получите 3 бесплатных конвертации
3. Загрузите PDF или TXT файл
4. Скачайте готовый dataset.md
5. После исчерпания лимита - оформите подписку

### Для администратора:
- Логи находятся в папке `logs/`
- База данных создается автоматически при первом запуске
- Для сброса БД удалите все таблицы и перезапустите приложение

---

## Безопасность

Приложение включает следующие меры защиты:
- ✅ CSRF-токены для всех форм
- ✅ Rate-limiting на входе (5 попыток / 5 минут)
- ✅ Шифрование паролей (Werkzeug)
- ✅ Защита от XSS и кликджекинга
- ✅ Валидация загружаемых файлов
- ✅ Secure cookies для сессий

---

## Решение проблем

### Ошибка подключения к PostgreSQL
```
sqlalchemy.exc.OperationalError: could not connect to server
```
**Решение:** Проверьте что PostgreSQL запущен и данные в DATABASE_URL верны.

### Ошибка "CSRF token missing"
**Решение:** Убедитесь что в шаблонах есть `{{ csrf_token() }}` в формах.

### Файл не загружается
**Решение:** Проверьте:
1. Размер файла не превышает 16MB
2. Расширение .pdf или .txt
3. Папка `uploads` существует и доступна для записи

---

## Контакты

При возникновении проблем проверьте логи в `logs/rag_converter.log`

