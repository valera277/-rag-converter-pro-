{% extends "base.html" %}

{% block title %}Subscribe - RAG Converter Pro{% endblock %}

{% block content %}
<div style="padding-top: 120px;">
    <div class="container" style="max-width: 600px;">
        <div style="text-align: center; margin-bottom: 40px;">
            <h1 style="font-size: 2.5rem; margin-bottom: 16px;">Subscribe Now</h1>
            <p style="color: var(--text-muted);">Unlimited conversions for ${{ price }}/month</p>
        </div>

        <div class="pricing-card">
            <span class="pricing-badge">Pro Subscription</span>
            <h3 style="font-size: 1.5rem; margin-top: 16px;">RAG Converter Pro</h3>
            <div class="pricing-amount">${{ price }}<span> /mo</span></div>

            <ul class="pricing-features">
                <li>Unlimited Conversions</li>
                <li>Support for PDF & TXT</li>
                <li>Smart Text Cleaning</li>
                <li>Optimal Chunking</li>
                <li>Operation History</li>
                <li>Cancel Anytime</li>
            </ul>

            <!-- Paddle Checkout -->
            <button type="button" class="btn btn-primary" style="width: 100%;" id="paddle-checkout-btn">
                Pay with Paddle
            </button>

            <p style="margin-top: 20px; font-size: 0.875rem; color: var(--text-muted);">
                Secure payment via Paddle. Subscription automatically renews every month.
            </p>
        </div>

        <div style="text-align: center; margin-top: 32px;">
            <a href="{{ url_for('main.dashboard') }}" style="color: var(--text-muted);">‚Üê Back to Dashboard</a>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.paddle.com/paddle/v2/paddle.js"></script>
<script>
    Paddle.Environment.set("{{ 'sandbox' if paddle_env == 'sandbox' else 'production' }}");
    Paddle.Initialize({
        token: "{{ paddle_token }}",
        eventCallback: function (event) {
            if (event && event.name === "checkout.completed" && typeof gtag === "function") {
                const txId =
                    (event.data && event.data.transaction_id) ||
                    (event.data && event.data.id) ||
                    "";

                gtag("event", "conversion", {
                    send_to: "AW-17942102489/Sz_MCJTp1vYbENmDu-tC",
                    transaction_id: txId
                });
            }
        }
    });

    const checkoutBtn = document.getElementById("paddle-checkout-btn");
    checkoutBtn.addEventListener("click", function () {
        Paddle.Checkout.open({
            items: [
                { priceId: "{{ paddle_price_id }}", quantity: 1 }
            ],
            customer: { email: "{{ user_email }}" },
            customData: { user_id: "{{ user_id }}" }
        });
    });
</script>
{% endblock %}
